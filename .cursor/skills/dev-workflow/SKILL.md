---
name: dev-workflow
description: 开发工作流的主编排器。当用户说"下一阶段"、"继续开发"、"next task"、"proceed"或要求继续开发时使用。协调 spec-sync、progress-tracker、implement、testing-stage 和 checkpoint 技能形成管道，每次迭代完成一个子任务。
metadata:
  category: orchestration
  triggers: "next task, proceed, continue development, 下一阶段, 继续开发"
allowed-tools: Read
---

# 开发工作流编排器 (Development Workflow Orchestrator)

你是 Modular RAG MCP Server 的**项目经理 AI**。当用户要求继续开发时，你**必须**按顺序执行以下管道。

> **这是一个元技能**：它编排其他技能。每个阶段的**具体实现细节**在相应技能的 SKILL.md 文件中定义。此文件仅定义**管道流程**和**阶段间协调**。

---

## 阶段 0：激活虚拟环境（前提条件）

**在执行任何管道阶段之前**，激活项目的虚拟环境：

```powershell
# Windows PowerShell
.\.venv\Scripts\Activate.ps1
```

```bash
# macOS / Linux
source .venv/bin/activate
```

> 此步骤是强制的，必须在调用任何子技能之前完成。

---

## 管道阶段

| 阶段 | 技能 | 描述 | 技能文件 |
|------|------|------|----------|
| 1 | `spec-sync` | 同步规范文档 | `.cursor/skills/spec-sync/SKILL.md` |
| 2 | `progress-tracker` | 查找下一个任务 | `.cursor/skills/progress-tracker/SKILL.md` |
| 3 | `implement` | 执行实现 | `.cursor/skills/implement/SKILL.md` |
| 4 | `testing-stage` | 运行测试 | `.cursor/skills/testing-stage/SKILL.md` |
| 5 | `checkpoint` | 保存进度 | `.cursor/skills/checkpoint/SKILL.md` |

> **每个阶段的详细执行步骤、完成标准和输出格式，请参考相应的 SKILL.md 文件。**

---

## 管道流程

```
                    ┌──────────────────┐
                    │   用户: "下一阶段" │
                    └────────┬─────────┘
                             ▼
                  ┌──────────────────────┐
                  │  阶段 1: spec-sync   │
                  │  同步规范文档        │
                  └────────┬─────────────┘
                           ▼
                  ┌──────────────────────┐
                  │ 阶段 2: progress-    │
                  │         tracker      │
                  │ 查找下一个任务       │
                  └────────┬─────────────┘
                           │
                     ⚠️ 异常? ──→ 用户确认 → 更新 DEV_SPEC → 返回阶段1
                           │
                           ▼
                  ┌──────────────────────┐
          ┌──────▶│ 阶段 3: implement    │
          │       │ 执行实现             │
          │       └────────┬─────────────┘
          │                ▼
          │       ┌──────────────────────┐
          │       │ 阶段 4: testing-     │
          │       │         stage        │
          │       │ 运行测试             │
          │       └────────┬─────────────┘
          │                ▼
          │           ┌─────────┐
          │           │  测试   │
          │           │  通过?  │
          │           └────┬────┘
          │     否         │         是
          │     ┌──────────┴──────────┐
          │     ▼                     ▼
          │ 迭代次数 < 3?      ┌──────────────────────┐
          │     │              │  阶段 5: checkpoint  │
          │ 是  │              │  保存进度            │
          └─────┘              └──────────────────────┘
                │ 否（迭代次数 >= 3）
                ▼
          ┌──────────────────┐
          │ 上报给用户       │
          │ 人工干预         │
          └──────────────────┘
```

---

## 阶段间数据流

编排器负责在阶段之间传递上下文：

| 来源 | 目标 | 传递的数据 |
|------|------|------------|
| 阶段 2 | 阶段 3 | 任务 ID、任务名称、相关规范章节 |
| 阶段 3 | 阶段 4 | 变更的文件、模块路径 |
| 阶段 4 | 阶段 3 | 测试失败信息（失败时，用于迭代）|
| 阶段 4 | 阶段 5 | 测试结果、迭代次数 |
| 阶段 2,3,4 | 阶段 5 | 任务 ID、变更的文件、测试总结 |

---

## 快捷命令

> **重要提示**：每次执行"下一阶段"完成**一个子任务**（例如 A1 → A2 → A3），而不是整个阶段（例如 阶段 A → 阶段 B）。

| 用户说 | 管道行为 |
|--------|----------|
| "next task" / "下一阶段" | 完整管道（阶段 1-5），完成**下一个子任务** |
| "continue" / "继续实现" | 跳到阶段 3（假设任务已知）|
| "status" / "检查进度" | 仅阶段 2 |
| "sync spec" / "同步规范" | 仅阶段 1 |
| "run tests" / "运行测试" | 仅阶段 4 |
| "fix progress" / "修正进度" | 阶段 2 验证 + DEV_SPEC 更新 |

---

## 编排器规则

1. **委托**：每个阶段的具体逻辑由其技能定义；编排器只处理调用和流程
2. **规范是真实来源**：进度跟踪基于 `DEV_SPEC.md`
3. **阶段顺序**：除非明确指定，否则按 1→2→3→4→5 顺序执行
4. **单一子任务**：每次管道运行完成**一个子任务**
5. **用户确认**：阶段 2 后等待用户确认再继续
6. **测试优先于检查点**：阶段 4 必须通过才能进入阶段 5
7. **迭代纪律**：执行 3 次迭代限制
8. **两步检查点**：阶段 5 需要两次用户确认：
   - 第一次：验证工作总结（然后自动更新 DEV_SPEC.md）
   - 第二次：决定是否执行 git commit
